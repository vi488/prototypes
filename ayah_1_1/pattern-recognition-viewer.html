<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pattern Recognition Viewer - Ayah</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        /* Ayah Brand Colors */
        :root {
            --ayah-primary: #6048EB;
            --ayah-primary-hover: #4F3BC9;
            --ayah-primary-light: #F4F1FF;
            --ayah-primary-lighter: #F4FDFF;
            --ayah-primary-dark: #3A2A9E;
        }

        .bg-ayah-primary { background-color: var(--ayah-primary); }
        .bg-ayah-primary-light { background-color: var(--ayah-primary-light); }
        .text-ayah-primary { color: var(--ayah-primary); }
        .text-ayah-primary-dark { color: var(--ayah-primary-dark); }
        .border-ayah-primary { border-color: var(--ayah-primary); }
        .hover\:bg-ayah-primary:hover { background-color: var(--ayah-primary-hover); }

        /* Pattern highlighting */
        .pattern-match {
            background: linear-gradient(120deg, #a8edea 0%, #fed6e3 100%);
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
            border: 2px solid #10b981;
        }

        .pattern-keyword {
            background: linear-gradient(120deg, #ffecd2 0%, #fcb69f 100%);
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 500;
            border: 2px solid #f59e0b;
        }

        .pattern-topic {
            background: linear-gradient(120deg, #e0c3fc 0%, #9bb5ff 100%);
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 500;
            border: 2px solid #8b5cf6;
        }

        .regex-pattern {
            font-family: 'Courier New', monospace;
            background-color: #f3f4f6;
            padding: 8px 12px;
            border-radius: 6px;
            border-left: 4px solid var(--ayah-primary);
        }

        .confidence-bar {
            transition: width 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <div class="p-6 max-w-7xl mx-auto">
        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Pattern Recognition Viewer</h1>
            <p class="text-gray-600">Visual demonstration of regex patterns and keyword matching for session analysis</p>
        </div>

        <!-- Pattern Type Selector -->
        <div class="bg-white rounded-xl border border-gray-200 p-6 mb-8 shadow-sm">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Pattern Recognition Types</h2>
            <div class="flex flex-wrap gap-3">
                <button class="pattern-type-btn bg-ayah-primary text-white px-4 py-2 rounded-lg font-medium" data-type="problems">
                    Math Problems
                </button>
                <button class="pattern-type-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium hover:bg-gray-300" data-type="keywords">
                    Subject Keywords
                </button>
                <button class="pattern-type-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium hover:bg-gray-300" data-type="topics">
                    Topic Detection
                </button>
            </div>
        </div>

        <!-- Pattern Examples -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- Sample Chat Content -->
            <div class="bg-white rounded-xl border border-gray-200 p-6 shadow-sm">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Sample Chat Content</h2>
                <div class="bg-gray-50 rounded-lg p-4 font-mono text-sm max-h-96 overflow-y-auto" id="chat-content">
                    <div class="space-y-3">
                        <div class="bg-blue-100 p-3 rounded-lg">
                            <strong>Student:</strong> Hi! I need help with my algebra homework.
                        </div>
                        <div class="bg-green-100 p-3 rounded-lg">
                            <strong>AI Tutor:</strong> I'd be happy to help! What specific algebra topics are you working on?
                        </div>
                        <div class="bg-blue-100 p-3 rounded-lg">
                            <strong>Student:</strong> I have these problems: <span class="pattern-match">Solve: 2x + 5 = 15</span> and <span class="pattern-match">Find: 3y - 7 = 14</span>
                        </div>
                        <div class="bg-green-100 p-3 rounded-lg">
                            <strong>AI Tutor:</strong> Great! These are <span class="pattern-topic">linear equations</span>. Let's start with the first one. To solve <span class="pattern-keyword">algebra</span> problems like this, we need to isolate the variable.
                        </div>
                        <div class="bg-blue-100 p-3 rounded-lg">
                            <strong>Student:</strong> <span class="pattern-match">Problem 1:</span> For 2x + 5 = 15, do I subtract 5 from both sides?
                        </div>
                        <div class="bg-green-100 p-3 rounded-lg">
                            <strong>AI Tutor:</strong> Exactly! When we subtract 5 from both sides, we get 2x = 10. This is a fundamental concept in <span class="pattern-topic">equation solving</span>.
                        </div>
                        <div class="bg-blue-100 p-3 rounded-lg">
                            <strong>Student:</strong> So x = 5? <span class="pattern-match">Calculate: 2(5) + 5</span> to check?
                        </div>
                        <div class="bg-green-100 p-3 rounded-lg">
                            <strong>AI Tutor:</strong> Perfect! Yes, x = 5. And checking: 2(5) + 5 = 10 + 5 = 15 ✓. This demonstrates the importance of <span class="pattern-topic">solution verification</span> in <span class="pattern-keyword">mathematics</span>.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pattern Analysis Results -->
            <div class="bg-white rounded-xl border border-gray-200 p-6 shadow-sm">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Pattern Analysis Results</h2>
                
                <!-- Math Problems Section -->
                <div id="problems-section" class="pattern-section">
                    <h3 class="text-lg font-semibold text-green-800 mb-3">Math Problems Detected</h3>
                    <div class="space-y-3">
                        <div class="bg-green-50 rounded-lg p-3">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-medium text-green-900">Pattern: "Solve:"</span>
                                <span class="text-sm bg-green-200 text-green-800 px-2 py-1 rounded-full">95% confidence</span>
                            </div>
                            <div class="regex-pattern text-sm">
                                <code>/\b(solve|find|calculate|what\s+is):\s*[^.!?]+/gi</code>
                            </div>
                            <div class="mt-2 text-sm text-green-700">
                                <strong>Matches found:</strong> "Solve: 2x + 5 = 15", "Find: 3y - 7 = 14", "Calculate: 2(5) + 5"
                            </div>
                        </div>
                        
                        <div class="bg-blue-50 rounded-lg p-3">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-medium text-blue-900">Pattern: "Problem N:"</span>
                                <span class="text-sm bg-blue-200 text-blue-800 px-2 py-1 rounded-full">90% confidence</span>
                            </div>
                            <div class="regex-pattern text-sm">
                                <code>/\b(problem|question)\s*\d+[:.]/gi</code>
                            </div>
                            <div class="mt-2 text-sm text-blue-700">
                                <strong>Matches found:</strong> "Problem 1:"
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4 p-3 bg-gray-100 rounded-lg">
                        <div class="flex items-center justify-between">
                            <span class="font-medium text-gray-800">Total Problems Identified:</span>
                            <span class="text-2xl font-bold text-ayah-primary">4</span>
                        </div>
                        <div class="mt-2 text-sm text-gray-600">
                            Average confidence: 92.5% | Processing time: 0.8s
                        </div>
                    </div>
                </div>

                <!-- Keywords Section (Hidden by default) -->
                <div id="keywords-section" class="pattern-section hidden">
                    <h3 class="text-lg font-semibold text-orange-800 mb-3">Subject Keywords Detected</h3>
                    <div class="space-y-3">
                        <div class="bg-orange-50 rounded-lg p-3">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-medium text-orange-900">Math Keywords</span>
                                <span class="text-sm bg-orange-200 text-orange-800 px-2 py-1 rounded-full">12 matches</span>
                            </div>
                            <div class="text-sm text-orange-700 space-y-1">
                                <div><strong>Found:</strong> algebra (2x), mathematics (1x), equation (3x), solve (2x), calculate (2x), variable (2x)</div>
                                <div><strong>Study time attributed:</strong> 8 minutes 34 seconds</div>
                            </div>
                        </div>
                        
                        <div class="bg-yellow-50 rounded-lg p-3">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-medium text-yellow-900">General Education</span>
                                <span class="text-sm bg-yellow-200 text-yellow-800 px-2 py-1 rounded-full">3 matches</span>
                            </div>
                            <div class="text-sm text-yellow-700">
                                <div><strong>Found:</strong> homework (1x), help (1x), problems (1x)</div>
                                <div><strong>Study time attributed:</strong> 4 minutes 0 seconds</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Topics Section (Hidden by default) -->
                <div id="topics-section" class="pattern-section hidden">
                    <h3 class="text-lg font-semibold text-purple-800 mb-3">Topics Identified</h3>
                    <div class="space-y-3">
                        <div class="bg-purple-50 rounded-lg p-3">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-medium text-purple-900">New Topics (First Time)</span>
                                <span class="text-sm bg-purple-200 text-purple-800 px-2 py-1 rounded-full">2 topics</span>
                            </div>
                            <div class="text-sm text-purple-700 space-y-1">
                                <div>• <strong>Linear Equations</strong> - 4 exchanges, high confidence</div>
                                <div>• <strong>Solution Verification</strong> - 2 exchanges, medium confidence</div>
                            </div>
                        </div>
                        
                        <div class="bg-indigo-50 rounded-lg p-3">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-medium text-indigo-900">Reinforced Topics</span>
                                <span class="text-sm bg-indigo-200 text-indigo-800 px-2 py-1 rounded-full">1 topic</span>
                            </div>
                            <div class="text-sm text-indigo-700">
                                <div>• <strong>Equation Solving</strong> - Previously covered, reinforced with 3 exchanges</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4 p-3 bg-gray-100 rounded-lg">
                        <div class="text-sm text-gray-600">
                            <div><strong>Topic Detection Rules:</strong></div>
                            <div>• Minimum 3 exchanges for new topic recognition</div>
                            <div>• Predefined subject dictionaries used for matching</div>
                            <div>• Context analysis prevents false positives</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pattern Configuration -->
        <div class="bg-white rounded-xl border border-gray-200 p-6 shadow-sm">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Pattern Configuration</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Confidence Thresholds -->
                <div class="bg-gray-50 rounded-lg p-4">
                    <h3 class="font-medium text-gray-900 mb-3">Confidence Thresholds</h3>
                    <div class="space-y-3">
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span>Problem Detection</span>
                                <span class="font-medium">70%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-green-600 h-2 rounded-full confidence-bar" style="width: 70%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span>Topic Recognition</span>
                                <span class="font-medium">70%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-purple-600 h-2 rounded-full confidence-bar" style="width: 70%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span>Keyword Matching</span>
                                <span class="font-medium">60%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-orange-600 h-2 rounded-full confidence-bar" style="width: 60%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Performance Metrics -->
                <div class="bg-gray-50 rounded-lg p-4">
                    <h3 class="font-medium text-gray-900 mb-3">Performance Metrics</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Processing Speed</span>
                            <span class="text-sm font-medium text-green-600">0.8s avg</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Memory Usage</span>
                            <span class="text-sm font-medium text-blue-600">2.1 MB</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Success Rate</span>
                            <span class="text-sm font-medium text-purple-600">98.7%</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">False Positives</span>
                            <span class="text-sm font-medium text-red-600">1.3%</span>
                        </div>
                    </div>
                </div>

                <!-- Error Handling -->
                <div class="bg-gray-50 rounded-lg p-4">
                    <h3 class="font-medium text-gray-900 mb-3">Error Handling</h3>
                    <div class="space-y-2 text-sm">
                        <div class="flex items-center space-x-2">
                            <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                            <span class="text-gray-700">Graceful pattern failures</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                            <span class="text-gray-700">Fallback to duration tracking</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                            <span class="text-gray-700">Partial session analysis</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                            <span class="text-gray-700">Timeout protection (30s)</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Pattern type switching
        document.querySelectorAll('.pattern-type-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                // Update button states
                document.querySelectorAll('.pattern-type-btn').forEach(b => {
                    b.classList.remove('bg-ayah-primary', 'text-white');
                    b.classList.add('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
                });
                this.classList.remove('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
                this.classList.add('bg-ayah-primary', 'text-white');

                // Show/hide sections
                document.querySelectorAll('.pattern-section').forEach(section => {
                    section.classList.add('hidden');
                });
                document.getElementById(this.dataset.type + '-section').classList.remove('hidden');

                // Update highlighting in chat content
                updateChatHighlighting(this.dataset.type);
            });
        });

        function updateChatHighlighting(type) {
            const chatContent = document.getElementById('chat-content');
            // Reset all highlighting
            chatContent.querySelectorAll('.pattern-match, .pattern-keyword, .pattern-topic').forEach(el => {
                el.classList.remove('pattern-match', 'pattern-keyword', 'pattern-topic');
            });

            // Apply new highlighting based on type
            if (type === 'problems') {
                chatContent.querySelectorAll('span').forEach(span => {
                    if (span.textContent.includes('Solve:') || span.textContent.includes('Find:') || 
                        span.textContent.includes('Calculate:') || span.textContent.includes('Problem')) {
                        span.classList.add('pattern-match');
                    }
                });
            } else if (type === 'keywords') {
                chatContent.querySelectorAll('span').forEach(span => {
                    if (span.textContent.includes('algebra') || span.textContent.includes('mathematics')) {
                        span.classList.add('pattern-keyword');
                    }
                });
            } else if (type === 'topics') {
                chatContent.querySelectorAll('span').forEach(span => {
                    if (span.textContent.includes('linear equations') || span.textContent.includes('equation solving') || 
                        span.textContent.includes('solution verification')) {
                        span.classList.add('pattern-topic');
                    }
                });
            }
        }
    </script>
</body>
</html>
