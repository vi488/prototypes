<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Progress Tools - ayah</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <style>
        /* ayah Brand Colors */
        :root {
            /* Main Brand Blue Palette - Updated per brand guidelines */
            --ayah-primary: #6048EB;           /* Main brand blue */
            --ayah-primary-hover: #4F3BC9;     /* Darker blue for hover */
            --ayah-primary-light: #F4F1FF;     /* Light blue for accents - brand secondary */
            --ayah-primary-lighter: #F4FDFF;   /* Very light blue */
            --ayah-primary-dark: #043178;      /* Dark blue for emphasis - brand tertiary */

            /* Background Blues */
            --ayah-bg-light: #F4F1FF;          /* Subtle light background - brand secondary */
            --ayah-bg-medium: #F4FDFF;         /* Medium light background */
            --ayah-bg-dark: #6048EB;           /* Medium background - brand primary */

            /* Icon Colors - Harmonious variations using brand palette */
            --ayah-icon-primary: #6048EB;      /* Primary icons - main brand */
            --ayah-icon-secondary: #7B5EF0;    /* Secondary icons - lighter brand */
            --ayah-icon-tertiary: #9B8AF5;     /* Tertiary icons - even lighter brand */
            --ayah-icon-light: #B8ACFA;        /* Light icons - very light brand */

            /* Button Colors - Consistent system using brand palette */
            --ayah-btn-primary: #6048EB;       /* Primary buttons */
            --ayah-btn-primary-hover: #4F3BC9; /* Primary button hover */
            --ayah-btn-secondary: #7B5EF0;     /* Secondary buttons */
            --ayah-btn-secondary-hover: #043178; /* Secondary button hover */
        }

        body {
            font-family: "Söhne", ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            font-feature-settings: "cv02", "cv03", "cv04", "cv11";
            font-variation-settings: normal;
        }

        /* Utility Classes */
        .bg-ayah-primary { background-color: var(--ayah-primary); }
        .bg-ayah-primary-light { background-color: var(--ayah-primary-light); }
        .bg-ayah-primary-lighter { background-color: var(--ayah-primary-lighter); }
        .bg-ayah-primary-dark { background-color: var(--ayah-primary-dark); }
        .bg-ayah-bg-light { background-color: var(--ayah-bg-light); }
        .bg-ayah-bg-medium { background-color: var(--ayah-bg-medium); }
        .bg-ayah-bg-dark { background-color: var(--ayah-bg-dark); }

        .text-ayah-primary { color: var(--ayah-primary); }
        .text-ayah-primary-light { color: var(--ayah-primary-light); }
        .text-ayah-primary-dark { color: var(--ayah-primary-dark); }
        .text-ayah-icon-primary { color: var(--ayah-icon-primary); }
        .text-ayah-icon-secondary { color: var(--ayah-icon-secondary); }
        .text-ayah-icon-tertiary { color: var(--ayah-icon-tertiary); }
        .text-ayah-icon-light { color: var(--ayah-icon-light); }

        .border-ayah-primary { border-color: var(--ayah-primary); }
        .border-ayah-primary-light { border-color: var(--ayah-primary-light); }
        .border-ayah-bg-medium { border-color: var(--ayah-bg-medium); }

        .hover\:bg-ayah-primary:hover { background-color: var(--ayah-primary-hover); }
        .hover\:bg-ayah-primary-light:hover { background-color: var(--ayah-primary); }

        /* Interactive Chart Styles */
        .chart-type-btn, .period-btn {
            color: #6B7280;
            background-color: transparent;
        }

        .chart-type-btn.active, .period-btn.active {
            background-color: white;
            color: var(--ayah-primary);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .chart-type-btn:hover, .period-btn:hover {
            color: var(--ayah-primary);
        }

        /* Chart loading animation */
        @keyframes chartFadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .chart-fade-in {
            animation: chartFadeIn 0.5s ease-out;
        }

        /* Mobile touch optimization and responsive design */
        @media (max-width: 640px) {
            .chart-type-btn, .period-btn {
                min-height: 44px; /* iOS touch target minimum */
                padding: 8px 12px;
                font-size: 14px;
            }

            /* Mobile-optimized layout */
            .mobile-stack {
                flex-direction: column !important;
                gap: 1rem !important;
            }

            .mobile-full-width {
                width: 100% !important;
            }

            /* Larger text for mobile readability */
            .mobile-text-lg {
                font-size: 1.125rem !important;
            }

            .mobile-text-xl {
                font-size: 1.25rem !important;
            }

            /* Touch-friendly spacing */
            .mobile-touch-spacing {
                padding: 1rem !important;
            }

            /* Simplified mobile charts */
            .mobile-chart-container {
                height: 250px !important;
            }

            /* Mobile card stacking */
            .mobile-card-stack > * {
                margin-bottom: 1rem;
            }

            /* Mobile button groups */
            .mobile-btn-group {
                display: flex;
                flex-direction: column;
                gap: 0.5rem;
            }

            .mobile-btn-group .chart-type-btn,
            .mobile-btn-group .period-btn {
                width: 100%;
                justify-content: center;
            }
        }

        /* Tablet optimization */
        @media (min-width: 641px) and (max-width: 1024px) {
            .tablet-grid-2 {
                grid-template-columns: repeat(2, 1fr) !important;
            }

            .tablet-text-base {
                font-size: 1rem !important;
            }
        }

        /* Touch interaction feedback */
        .touch-feedback {
            transition: all 0.15s ease;
        }

        .touch-feedback:active {
            transform: scale(0.98);
            background-color: rgba(96, 72, 235, 0.1);
        }

        /* Background illustration blur effect - now applied directly to images */

        /* Loading states optimized for mobile */
        .mobile-loading {
            min-height: 200px;
        }

        /* Swipe indicators for mobile navigation */
        .swipe-indicator {
            display: none;
        }

        @media (max-width: 640px) {
            .swipe-indicator {
                display: block;
                text-align: center;
                color: #9CA3AF;
                font-size: 0.75rem;
                margin-top: 0.5rem;
            }
        }
    </style>
</head>
<body class="bg-white font-sans">
    <div class="px-6 py-8">
        <!-- Header - Mobile Optimized -->
        <div class="mb-8">
            <div class="flex flex-col sm:flex-row sm:items-center justify-between">
                <div class="mb-4 sm:mb-0">
                    <h1 class="text-2xl font-semibold text-gray-900 mb-2">Learning Progress</h1>
                    <p class="text-gray-600 text-sm">Track your academic achievements and goal progress</p>
                </div>
                <div class="flex items-center space-x-2">
                    <button class="p-2 rounded-lg hover:bg-gray-100 text-gray-600 transition-colors duration-200" title="Refresh data">
                        <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                    </button>
                    <button class="p-2 rounded-lg hover:bg-gray-100 text-gray-600 transition-colors duration-200" title="Settings">
                        <i data-lucide="settings" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Learning Statistics Overview - Redesigned for Better UX -->
        <div class="bg-white rounded-lg border border-gray-200 p-4 sm:p-6 mb-8">
            <!-- Header with Context -->
            <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-2">
                <div class="mb-2 sm:mb-0">
                    <h2 class="text-lg font-semibold text-gray-900">This Week's Progress</h2>
                    <p class="text-gray-600 text-sm">Sept 16-22, 2024 • 7 days tracked</p>
                </div>
                <div class="flex items-center space-x-2">
                    <button class="p-2 rounded-lg hover:bg-gray-100 text-gray-600 transition-colors duration-200">
                        <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                    </button>
                    <button class="p-2 rounded-lg hover:bg-gray-100 text-gray-600 transition-colors duration-200">
                        <i data-lucide="calendar" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>

            <!-- All Metrics in Single Row - Ordered by Importance -->
            <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3">
                <!-- 1. Study Time - Most Important -->
                <div class="bg-ayah-bg-light rounded-lg p-6 border border-ayah-bg-medium min-h-[160px] relative overflow-hidden">
                    <!-- Background Illustration - Centered -->
                    <div class="absolute bottom-4 right-2">
                        <img src="undraw-relaxed-reading-wfkr.svg" alt="Study Time" class="w-32 h-32">
                    </div>
                    <div class="relative z-10">
                        <div class="flex items-center space-x-2 mb-3">
                            <i data-lucide="clock" class="w-5 h-5 text-ayah-primary"></i>
                            <span class="text-base font-medium text-ayah-primary">Study Time</span>
                        </div>
                        <div class="text-4xl font-bold text-ayah-primary">3h 45m</div>
                        <div class="w-full bg-ayah-bg-medium rounded-full h-2 mt-12">
                            <div class="bg-ayah-primary h-2 rounded-full" style="width: 75%"></div>
                        </div>
                    </div>
                </div>

                <!-- 2. Problems Solved - High Engagement -->
                <div class="bg-ayah-bg-light rounded-lg p-6 border border-ayah-bg-medium min-h-[160px] relative overflow-hidden">
                    <!-- Background Illustration - Centered -->
                    <div class="absolute bottom-4 right-2">
                        <img src="undraw-problem-solving-8lg7.svg" alt="Problems Solved" class="w-32 h-32">
                    </div>
                    <div class="relative z-10">
                        <div class="flex items-center space-x-2 mb-3">
                            <i data-lucide="brain" class="w-5 h-5 text-ayah-primary"></i>
                            <span class="text-base font-medium text-ayah-primary">Problems</span>
                        </div>
                        <div class="text-4xl font-bold text-ayah-primary">28</div>
                        <div class="w-full bg-ayah-bg-medium rounded-full h-2 mt-12">
                            <div class="bg-ayah-primary h-2 rounded-full" style="width: 93%"></div>
                        </div>
                    </div>
                </div>

                <!-- 3. Learning Streak - Motivational -->
                <div class="bg-ayah-bg-light rounded-lg p-6 border border-ayah-bg-medium min-h-[160px] relative overflow-hidden">
                    <!-- Background Illustration - Centered -->
                    <div class="absolute bottom-8 right-2">
                        <img src="undraw-certification-i2m0.svg" alt="Learning Streak" class="w-28 h-28">
                    </div>
                    <div class="relative z-10">
                        <div class="flex items-center space-x-2 mb-3">
                            <i data-lucide="zap" class="w-5 h-5 text-ayah-primary"></i>
                            <span class="text-base font-medium text-ayah-primary">Streak</span>
                        </div>
                        <div class="text-4xl font-bold text-ayah-primary">5 days</div>
                        <div class="w-full bg-ayah-bg-medium rounded-full h-2 mt-12">
                            <div class="bg-ayah-primary h-2 rounded-full" style="width: 83%"></div>
                        </div>
                    </div>
                </div>

                <!-- 4. Topics Learned - Progress Indicator -->
                <div class="bg-ayah-bg-light rounded-lg p-6 border border-ayah-bg-medium min-h-[160px] relative overflow-hidden">
                    <!-- Background Illustration - Centered -->
                    <div class="absolute bottom-8 right-2">
                        <img src="undraw-knowledge-0ty5.svg" alt="Topics Learned" class="w-28 h-28">
                    </div>
                    <div class="relative z-10">
                        <div class="flex items-center space-x-2 mb-3">
                            <i data-lucide="book-open" class="w-5 h-5 text-ayah-primary"></i>
                            <span class="text-base font-medium text-ayah-primary">Topics</span>
                        </div>
                        <div class="text-4xl font-bold text-ayah-primary">7</div>
                        <div class="w-full bg-ayah-bg-medium rounded-full h-2 mt-12">
                            <div class="bg-ayah-primary h-2 rounded-full" style="width: 70%"></div>
                        </div>
                    </div>
                </div>

                <!-- 5. Sessions Completed - Activity Metric -->
                <div class="bg-ayah-bg-light rounded-lg p-6 border border-ayah-bg-medium min-h-[160px] relative overflow-hidden">
                    <!-- Background Illustration - Centered -->
                    <div class="absolute bottom-4 right-2">
                        <img src="undraw-online-learning-tgmv.svg" alt="Sessions Completed" class="w-32 h-32">
                    </div>
                    <div class="relative z-10">
                        <div class="flex items-center space-x-2 mb-3">
                            <i data-lucide="play-circle" class="w-5 h-5 text-ayah-primary"></i>
                            <span class="text-base font-medium text-ayah-primary">Sessions</span>
                        </div>
                        <div class="text-4xl font-bold text-ayah-primary">12</div>
                        <div class="w-full bg-ayah-bg-medium rounded-full h-2 mt-12">
                            <div class="bg-ayah-primary h-2 rounded-full" style="width: 80%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Learning Progress Charts - Mobile Optimized -->
        <div class="bg-white rounded-xl border border-gray-200 p-4 sm:p-6 mb-6 sm:mb-8">
            <div class="flex flex-col space-y-4 mb-6">
                <div class="flex flex-col sm:flex-row sm:items-center justify-between">
                    <div class="mb-3 sm:mb-0">
                        <h2 class="text-lg sm:text-xl font-semibold text-gray-800">Learning Progress Charts</h2>
                        <p class="text-sm text-gray-600 mt-1">See how your learning is going over time</p>
                    </div>
                    <!-- Mobile: Show chart info -->
                    <div class="sm:hidden text-right">
                        <div class="text-xs text-gray-500">Tap chart for details</div>
                        <div class="text-xs text-gray-500">Swipe to navigate</div>
                    </div>
                </div>

                <!-- Mobile-optimized controls -->
                <div class="space-y-3 sm:space-y-0 sm:flex sm:space-x-3">
                    <!-- Chart Type Selector - Mobile Stack -->
                    <div class="mobile-btn-group sm:flex bg-gray-100 rounded-lg p-1">
                        <button id="lineChartBtn" class="chart-type-btn active px-3 py-2 rounded-md text-sm font-medium transition-colors touch-feedback">
                            <i data-lucide="trending-up" class="w-4 h-4 inline mr-2"></i>Line Chart
                        </button>
                        <button id="barChartBtn" class="chart-type-btn px-3 py-2 rounded-md text-sm font-medium transition-colors touch-feedback">
                            <i data-lucide="bar-chart-3" class="w-4 h-4 inline mr-2"></i>Bar Chart
                        </button>
                        <button id="areaChartBtn" class="chart-type-btn px-3 py-2 rounded-md text-sm font-medium transition-colors touch-feedback">
                            <i data-lucide="area-chart" class="w-4 h-4 inline mr-2"></i>Area Chart
                        </button>
                    </div>
                    <!-- Time Period Selector - Mobile Stack -->
                    <div class="mobile-btn-group sm:flex bg-gray-100 rounded-lg p-1">
                        <button id="period7" class="period-btn active px-4 py-2 rounded-md text-sm font-medium transition-colors touch-feedback" data-period="7">Last 7 Days</button>
                        <button id="period14" class="period-btn px-4 py-2 rounded-md text-sm font-medium transition-colors touch-feedback" data-period="14">Last 14 Days</button>
                        <button id="period30" class="period-btn px-4 py-2 rounded-md text-sm font-medium transition-colors touch-feedback" data-period="30">Last 30 Days</button>
                    </div>
                </div>
            </div>



            <!-- Loading State - Mobile Optimized -->
            <div id="chartLoading" class="h-64 sm:h-80 w-full flex items-center justify-center bg-gray-50 rounded-lg mobile-loading">
                <div class="text-center">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-ayah-primary mx-auto mb-2"></div>
                    <p class="text-sm text-gray-600">Getting your progress ready...</p>
                    <p class="text-xs text-gray-500 mt-1">Almost there! ✨</p>
                </div>
            </div>

            <!-- Interactive Chart Container - Mobile Optimized -->
            <div id="chartContainer" class="h-64 sm:h-80 w-full relative mobile-chart-container" style="display: none;">
                <canvas id="progressChart" class="w-full h-full touch-action-manipulation"></canvas>
                <!-- Mobile chart overlay for touch interactions -->
                <div class="sm:hidden absolute top-2 right-2 bg-white bg-opacity-90 rounded-lg p-2 text-xs text-gray-600">
                    <div class="flex items-center space-x-1">
                        <i data-lucide="touch" class="w-3 h-3"></i>
                        <span>Tap for details</span>
                    </div>
                </div>
            </div>

            <!-- Mobile swipe indicator -->
            <div class="swipe-indicator">
                <i data-lucide="chevrons-left-right" class="w-4 h-4 inline mr-1"></i>
                Swipe chart to explore data points
            </div>

            <!-- Chart Performance Info -->
            <div class="flex items-center justify-between mt-4 text-xs text-gray-500">
                <div class="flex items-center space-x-4">
                    <span id="dataPoints">Data points: 7</span>
                    <span id="lastUpdated">Last updated: 2 min ago</span>
                </div>
                <div class="flex items-center space-x-2">
                    <div class="w-2 h-2 bg-ayah-primary rounded-full"></div>
                    <span>Real-time updates</span>
                </div>
            </div>


        </div>

        <!-- Learning Goals Progress -->
        <div class="bg-white rounded-xl border border-gray-200 p-6 mb-8">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h2 class="text-xl font-semibold text-gray-800">Goals Progress</h2>
                    <p class="text-gray-600">Overview of your Learning Goals performance</p>
                </div>
                <button class="text-ayah-primary hover:text-ayah-primary-hover text-sm font-medium">
                    View All Goals →
                </button>
            </div>

            <!-- Goals Statistics Grid -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="bg-ayah-bg-light rounded-lg p-4 text-center">
                    <div class="w-8 h-8 bg-ayah-bg-medium rounded-full flex items-center justify-center mx-auto mb-2">
                        <i data-lucide="target" class="w-4 h-4 text-ayah-primary"></i>
                    </div>
                    <div class="text-sm text-gray-600">Active Goals</div>
                    <div class="text-lg font-semibold text-ayah-primary">3</div>
                </div>
                <div class="bg-ayah-bg-light rounded-lg p-4 text-center">
                    <div class="w-8 h-8 bg-ayah-bg-medium rounded-full flex items-center justify-center mx-auto mb-2">
                        <i data-lucide="check-circle" class="w-4 h-4 text-ayah-icon-secondary"></i>
                    </div>
                    <div class="text-sm text-gray-600">Completed</div>
                    <div class="text-lg font-semibold text-ayah-icon-secondary">2</div>
                </div>
                <div class="bg-ayah-bg-light rounded-lg p-4 text-center">
                    <div class="w-8 h-8 bg-ayah-bg-medium rounded-full flex items-center justify-center mx-auto mb-2">
                        <i data-lucide="trending-up" class="w-4 h-4 text-ayah-icon-tertiary"></i>
                    </div>
                    <div class="text-sm text-gray-600">On Track</div>
                    <div class="text-lg font-semibold text-ayah-icon-tertiary">2</div>
                </div>
                <div class="bg-ayah-bg-light rounded-lg p-4 text-center">
                    <div class="w-8 h-8 bg-ayah-bg-medium rounded-full flex items-center justify-center mx-auto mb-2">
                        <i data-lucide="percent" class="w-4 h-4 text-ayah-primary-dark"></i>
                    </div>
                    <div class="text-sm text-gray-600">Avg Progress</div>
                    <div class="text-lg font-semibold text-ayah-primary-dark">68%</div>
                </div>
            </div>
        </div>

        <!-- Next Steps Recommendations -->
        <div class="bg-white rounded-xl border border-gray-200 p-6 mb-8">
            <h2 class="text-xl font-semibold text-gray-800 mb-6">Next Steps</h2>
            <div class="space-y-4">
                <div class="flex items-start space-x-3 p-4 bg-ayah-bg-light rounded-lg">
                    <div class="w-8 h-8 bg-ayah-bg-medium rounded-full flex items-center justify-center flex-shrink-0">
                        <i data-lucide="brain" class="w-4 h-4 text-ayah-primary"></i>
                    </div>
                    <div>
                        <p class="font-medium text-gray-900">Continue working on Math - you're almost there!</p>
                        <p class="text-sm text-gray-600">12 of 20 problems completed (60%)</p>
                    </div>
                </div>
                <div class="flex items-start space-x-3 p-4 bg-ayah-bg-light rounded-lg">
                    <div class="w-8 h-8 bg-ayah-bg-medium rounded-full flex items-center justify-center flex-shrink-0">
                        <i data-lucide="clock" class="w-4 h-4 text-ayah-icon-secondary"></i>
                    </div>
                    <div>
                        <p class="font-medium text-gray-900">Try a quick Science session to maintain your streak</p>
                        <p class="text-sm text-gray-600">15 more minutes needed to reach your goal</p>
                    </div>
                </div>
                <div class="flex items-start space-x-3 p-4 bg-ayah-bg-light rounded-lg">
                    <div class="w-8 h-8 bg-ayah-bg-medium rounded-full flex items-center justify-center flex-shrink-0">
                        <i data-lucide="star" class="w-4 h-4 text-ayah-icon-tertiary"></i>
                    </div>
                    <div>
                        <p class="font-medium text-gray-900">Great progress on History - consider setting a new challenge</p>
                        <p class="text-sm text-gray-600">2 of 5 topics completed</p>
                    </div>
                </div>
            </div>
        </div>



    </div>

    <script>
        lucide.createIcons();

        // Interactive Progress Charts Implementation
        class InteractiveProgressCharts {
            constructor() {
                this.chart = null;
                this.currentChartType = 'line';
                this.currentPeriod = 7;
                this.chartData = this.generateSampleData();

                this.init();
            }

            init() {
                this.setupEventListeners();
                this.simulateLoading();
            }

            setupEventListeners() {
                // Chart type buttons
                document.querySelectorAll('.chart-type-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.handleChartTypeChange(e.target);
                    });
                });

                // Period buttons
                document.querySelectorAll('.period-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.handlePeriodChange(e.target);
                    });
                });

                // Mobile touch optimization
                if ('ontouchstart' in window) {
                    this.setupTouchOptimization();
                }
            }

            setupTouchOptimization() {
                // Add touch-friendly interactions
                document.querySelectorAll('.chart-type-btn, .period-btn').forEach(btn => {
                    btn.style.minHeight = '44px';
                    btn.addEventListener('touchstart', function() {
                        this.style.backgroundColor = 'rgba(96, 72, 235, 0.1)';
                        this.style.transform = 'scale(0.98)';
                    });
                    btn.addEventListener('touchend', function() {
                        this.style.transform = 'scale(1)';
                        setTimeout(() => {
                            if (!this.classList.contains('active')) {
                                this.style.backgroundColor = 'transparent';
                            }
                        }, 150);
                    });
                });

                // Add swipe gesture support for mobile chart navigation
                this.setupSwipeGestures();

                // Add mobile-specific chart interactions
                this.setupMobileChartInteractions();
            }

            setupSwipeGestures() {
                const chartContainer = document.getElementById('chartContainer');
                let startX = 0;
                let startY = 0;
                let isSwipe = false;

                chartContainer.addEventListener('touchstart', (e) => {
                    startX = e.touches[0].clientX;
                    startY = e.touches[0].clientY;
                    isSwipe = false;
                });

                chartContainer.addEventListener('touchmove', (e) => {
                    if (!startX || !startY) return;

                    const currentX = e.touches[0].clientX;
                    const currentY = e.touches[0].clientY;
                    const diffX = Math.abs(currentX - startX);
                    const diffY = Math.abs(currentY - startY);

                    // Detect horizontal swipe
                    if (diffX > diffY && diffX > 50) {
                        isSwipe = true;
                        e.preventDefault();
                    }
                });

                chartContainer.addEventListener('touchend', (e) => {
                    if (!isSwipe || !startX) return;

                    const endX = e.changedTouches[0].clientX;
                    const diffX = startX - endX;

                    // Swipe left - next period
                    if (diffX > 50) {
                        this.cyclePeriod(1);
                    }
                    // Swipe right - previous period
                    else if (diffX < -50) {
                        this.cyclePeriod(-1);
                    }

                    startX = 0;
                    startY = 0;
                    isSwipe = false;
                });
            }

            setupMobileChartInteractions() {
                // Add haptic feedback for mobile devices
                if ('vibrate' in navigator) {
                    document.querySelectorAll('.chart-type-btn, .period-btn').forEach(btn => {
                        btn.addEventListener('click', () => {
                            navigator.vibrate(50); // Short vibration feedback
                        });
                    });
                }

                // Add double-tap to reset zoom on mobile
                const chartCanvas = document.getElementById('progressChart');
                let lastTap = 0;

                chartCanvas.addEventListener('touchend', (e) => {
                    const currentTime = new Date().getTime();
                    const tapLength = currentTime - lastTap;

                    if (tapLength < 500 && tapLength > 0) {
                        // Double tap detected - reset chart view
                        if (this.chart) {
                            this.chart.resetZoom();
                            if ('vibrate' in navigator) {
                                navigator.vibrate([50, 50, 50]); // Triple vibration for reset
                            }
                        }
                    }
                    lastTap = currentTime;
                });
            }

            cyclePeriod(direction) {
                const periods = [7, 14, 30];
                const currentIndex = periods.indexOf(this.currentPeriod);
                let newIndex = currentIndex + direction;

                // Wrap around
                if (newIndex < 0) newIndex = periods.length - 1;
                if (newIndex >= periods.length) newIndex = 0;

                const newPeriod = periods[newIndex];
                const periodBtn = document.querySelector(`[data-period="${newPeriod}"]`);

                if (periodBtn) {
                    this.handlePeriodChange(periodBtn);

                    // Visual feedback for swipe
                    periodBtn.style.transform = 'scale(1.05)';
                    setTimeout(() => {
                        periodBtn.style.transform = 'scale(1)';
                    }, 200);
                }
            }

            simulateLoading() {
                // Show loading state for 1.5 seconds to demonstrate loading UX
                setTimeout(() => {
                    document.getElementById('chartLoading').style.display = 'none';
                    document.getElementById('chartContainer').style.display = 'block';
                    document.getElementById('chartContainer').classList.add('chart-fade-in');
                    this.createChart();
                    this.updateLastUpdated();
                }, 1500);
            }

            generateSampleData() {
                const data = {
                    7: this.generateDataPoints(7),
                    14: this.generateDataPoints(14),
                    30: this.generateDataPoints(30)
                };
                return data;
            }

            generateDataPoints(days) {
                const data = [];
                const today = new Date();

                for (let i = days - 1; i >= 0; i--) {
                    const date = new Date(today);
                    date.setDate(date.getDate() - i);

                    // Generate realistic learning data with some patterns
                    const isWeekend = date.getDay() === 0 || date.getDay() === 6;
                    const baseStudyTime = isWeekend ? 45 : 75; // Less study on weekends
                    const baseProblemsSolved = isWeekend ? 8 : 15;

                    data.push({
                        date: date.toISOString().split('T')[0],
                        displayDate: date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),
                        studyTime: Math.max(0, baseStudyTime + Math.random() * 60 - 30),
                        problemsSolved: Math.max(0, baseProblemsSolved + Math.random() * 10 - 5),
                        topicsLearned: Math.floor(Math.random() * 5) + 1,
                        progressPercentage: Math.min(100, 60 + Math.random() * 40)
                    });
                }

                return data;
            }

            createChart() {
                const ctx = document.getElementById('progressChart').getContext('2d');
                const data = this.chartData[this.currentPeriod];

                // Destroy existing chart if it exists
                if (this.chart) {
                    this.chart.destroy();
                }

                const chartConfig = this.getChartConfig(data);
                this.chart = new Chart(ctx, chartConfig);

                // Update data points counter
                document.getElementById('dataPoints').textContent = `Data points: ${data.length}`;
            }

            getChartConfig(data) {
                const labels = data.map(d => d.displayDate);
                const studyTimeData = data.map(d => Math.round(d.studyTime));
                const problemsData = data.map(d => Math.round(d.problemsSolved));

                const baseConfig = {
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Study Time (minutes)',
                                data: studyTimeData,
                                borderColor: '#043178',
                                backgroundColor: this.currentChartType === 'line' ? 'rgba(4, 49, 120, 0.1)' : 'rgba(4, 49, 120, 0.6)',
                                tension: 0.4,
                                fill: this.currentChartType === 'area'
                            },
                            {
                                label: 'Problems Solved',
                                data: problemsData,
                                borderColor: '#6048EB',
                                backgroundColor: this.currentChartType === 'line' ? 'rgba(96, 72, 235, 0.1)' : 'rgba(96, 72, 235, 0.6)',
                                tension: 0.4,
                                fill: this.currentChartType === 'area'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        // Mobile-optimized touch interactions
                        onHover: (event, activeElements) => {
                            if (window.innerWidth <= 640 && activeElements.length > 0) {
                                // Provide haptic feedback on mobile hover
                                if ('vibrate' in navigator) {
                                    navigator.vibrate(25);
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                backgroundColor: 'rgba(255, 255, 255, 0.95)',
                                titleColor: '#374151',
                                bodyColor: '#6B7280',
                                borderColor: '#E5E7EB',
                                borderWidth: 1,
                                cornerRadius: 8,
                                displayColors: true,
                                // Mobile-optimized tooltip
                                titleFont: {
                                    size: window.innerWidth <= 640 ? 14 : 12
                                },
                                bodyFont: {
                                    size: window.innerWidth <= 640 ? 13 : 11
                                },
                                padding: window.innerWidth <= 640 ? 12 : 8,
                                callbacks: {
                                    title: (context) => {
                                        const dataIndex = context[0].dataIndex;
                                        const dataPoint = data[dataIndex];
                                        return `${dataPoint.displayDate} - ${dataPoint.progressPercentage.toFixed(1)}% progress`;
                                    },
                                    afterBody: (context) => {
                                        const dataIndex = context[0].dataIndex;
                                        const dataPoint = data[dataIndex];
                                        const avgStudyTime = studyTimeData.reduce((a, b) => a + b, 0) / studyTimeData.length;
                                        const avgProblems = problemsData.reduce((a, b) => a + b, 0) / problemsData.length;

                                        return [
                                            `Topics learned: ${dataPoint.topicsLearned}`,
                                            `Study time vs avg: ${dataPoint.studyTime > avgStudyTime ? '+' : ''}${(dataPoint.studyTime - avgStudyTime).toFixed(0)} min`,
                                            `Problems vs avg: ${dataPoint.problemsSolved > avgProblems ? '+' : ''}${(dataPoint.problemsSolved - avgProblems).toFixed(0)}`
                                        ];
                                    }
                                }
                            },
                            legend: {
                                position: 'bottom',
                                labels: {
                                    usePointStyle: true,
                                    padding: 20,
                                    font: {
                                        size: 12
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.1)'
                                },
                                ticks: {
                                    color: '#6B7280',
                                    font: {
                                        size: window.innerWidth <= 640 ? 11 : 10
                                    }
                                }
                            },
                            x: {
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.1)'
                                },
                                ticks: {
                                    color: '#6B7280',
                                    font: {
                                        size: window.innerWidth <= 640 ? 11 : 10
                                    },
                                    maxRotation: window.innerWidth <= 640 ? 45 : 0,
                                    minRotation: window.innerWidth <= 640 ? 45 : 0
                                }
                            }
                        },
                        animation: {
                            duration: 750,
                            easing: 'easeInOutQuart'
                        }
                    }
                };

                // Set chart type
                if (this.currentChartType === 'bar') {
                    baseConfig.type = 'bar';
                    baseConfig.data.datasets.forEach(dataset => {
                        dataset.tension = 0;
                        dataset.fill = false;
                    });
                } else {
                    baseConfig.type = 'line';
                    if (this.currentChartType === 'area') {
                        baseConfig.data.datasets.forEach(dataset => {
                            dataset.fill = true;
                        });
                    }
                }

                return baseConfig;
            }

            handleChartTypeChange(button) {
                // Update active state
                document.querySelectorAll('.chart-type-btn').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');

                // Update chart type
                if (button.id === 'lineChartBtn') this.currentChartType = 'line';
                else if (button.id === 'barChartBtn') this.currentChartType = 'bar';
                else if (button.id === 'areaChartBtn') this.currentChartType = 'area';

                // Recreate chart with new type
                this.createChart();
            }

            handlePeriodChange(button) {
                // Update active state
                document.querySelectorAll('.period-btn').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');

                // Update period
                this.currentPeriod = parseInt(button.dataset.period);

                // Recreate chart with new data
                this.createChart();
            }

            updateLastUpdated() {
                const now = new Date();
                const timeString = now.toLocaleTimeString('en-US', {
                    hour: 'numeric',
                    minute: '2-digit',
                    hour12: true
                });
                document.getElementById('lastUpdated').textContent = `Last updated: ${timeString}`;

                // Update every 5 minutes as per business rules
                setTimeout(() => this.updateLastUpdated(), 5 * 60 * 1000);
            }
        }

        // Initialize the interactive charts when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new InteractiveProgressCharts();
        });

        // Add click handlers for buttons
        document.addEventListener('click', function(e) {
            if (e.target.matches('button')) {
                const buttonText = e.target.textContent.trim();
                console.log('Progress action clicked:', buttonText);

                // Simple visual feedback
                e.target.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    e.target.style.transform = 'scale(1)';
                }, 150);
            }
        });
    </script>
</body>
</html>
