<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Goal - Finu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        /* Finu Brand Colors */
        :root {
            --finu-primary: #497AFF;
            --finu-primary-hover: #3B5FE6;
            --finu-primary-light: #F3FAFF;
            --finu-primary-dark: #043178;
        }

        .bg-finu-primary { background-color: var(--finu-primary); }
        .bg-finu-primary-light { background-color: var(--finu-primary-light); }
        .text-finu-primary { color: var(--finu-primary); }
        .text-finu-primary-dark { color: var(--finu-primary-dark); }
        .border-finu-primary { border-color: var(--finu-primary); }
        .hover\:bg-finu-primary:hover { background-color: var(--finu-primary-hover); }

        /* Custom input styling */
        .form-input {
            transition: all 0.2s ease;
        }
        .form-input:focus {
            box-shadow: 0 0 0 3px rgba(73, 122, 255, 0.1);
        }

        /* Modal animation */
        .modal-enter {
            animation: modalEnter 0.3s ease-out;
        }

        @keyframes modalEnter {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(-10px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <!-- Modal Overlay -->
    <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <!-- Modal Content -->
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto modal-enter">
            <div class="p-6">
        <!-- Modal Header -->
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-xl font-semibold text-gray-900">Add New Goal</h2>
            <button onclick="closeModal()" class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
            </button>
        </div>

        <!-- Goal Form -->
        <form id="goalForm" class="space-y-6">
            <!-- Goal Name -->
            <div>
                <label for="goalName" class="block text-sm font-medium text-gray-700 mb-2">Goal Name</label>
                <input type="text" id="goalName" name="goalName" placeholder="e.g., Emergency Fund" class="form-input w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-finu-primary focus:border-transparent" required>
            </div>

            <!-- Description -->
            <div>
                <label for="description" class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                <textarea id="description" name="description" rows="3" placeholder="Describe your goal..." class="form-input w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-finu-primary focus:border-transparent resize-none"></textarea>
            </div>

            <!-- Target and Current Amount -->
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label for="targetAmount" class="block text-sm font-medium text-gray-700 mb-2">Target Amount</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <span class="text-gray-500 text-lg">$</span>
                        </div>
                        <input type="number" id="targetAmount" name="targetAmount" step="0.01" min="0" placeholder="0.00" class="form-input w-full pl-8 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-finu-primary focus:border-transparent" required>
                    </div>
                </div>
                <div>
                    <label for="currentAmount" class="block text-sm font-medium text-gray-700 mb-2">Current Amount</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <span class="text-gray-500 text-lg">$</span>
                        </div>
                        <input type="number" id="currentAmount" name="currentAmount" step="0.01" min="0" placeholder="0.00" class="form-input w-full pl-8 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-finu-primary focus:border-transparent">
                    </div>
                </div>
            </div>

            <!-- Target Date -->
            <div>
                <label for="targetDate" class="block text-sm font-medium text-gray-700 mb-2">Target Date (Optional)</label>
                <input type="date" id="targetDate" name="targetDate" class="form-input w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-finu-primary focus:border-transparent">
            </div>

            <!-- Priority -->
            <div>
                <label for="priority" class="block text-sm font-medium text-gray-700 mb-2">Priority</label>
                <select id="priority" name="priority" class="form-input w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-finu-primary focus:border-transparent">
                    <option value="Low">Low</option>
                    <option value="Medium" selected>Medium</option>
                    <option value="High">High</option>
                </select>
            </div>

            <!-- Progress Preview -->
            <div id="progressPreview" class="bg-gray-50 rounded-lg p-4 hidden">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm font-medium text-gray-700">Progress</span>
                    <span id="progressPercentage" class="text-sm text-gray-600">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div id="progressBar" class="bg-finu-primary h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
                <div class="flex justify-between mt-2 text-xs text-gray-500">
                    <span id="currentAmountDisplay">$0.00</span>
                    <span id="targetAmountDisplay">$0.00</span>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="flex space-x-3 pt-4">
                <button type="button" onclick="closeModal()" class="flex-1 px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg font-medium transition-colors">
                    Cancel
                </button>
                <button type="submit" class="flex-1 px-4 py-2 bg-finu-primary hover:bg-finu-primary text-white rounded-lg font-medium transition-colors">
                    Create Goal
                </button>
            </div>
        </form>
            </div>
        </div>
    </div>

    <script>
        // Update progress preview when amounts change
        function updateProgressPreview() {
            const targetAmount = parseFloat(document.getElementById('targetAmount').value) || 0;
            const currentAmount = parseFloat(document.getElementById('currentAmount').value) || 0;
            
            if (targetAmount > 0) {
                document.getElementById('progressPreview').classList.remove('hidden');
                
                const percentage = Math.min((currentAmount / targetAmount) * 100, 100);
                
                document.getElementById('progressPercentage').textContent = `${percentage.toFixed(1)}%`;
                document.getElementById('progressBar').style.width = `${percentage}%`;
                document.getElementById('currentAmountDisplay').textContent = `$${currentAmount.toFixed(2)}`;
                document.getElementById('targetAmountDisplay').textContent = `$${targetAmount.toFixed(2)}`;
            } else {
                document.getElementById('progressPreview').classList.add('hidden');
            }
        }

        // Add event listeners for amount inputs
        document.getElementById('targetAmount').addEventListener('input', updateProgressPreview);
        document.getElementById('currentAmount').addEventListener('input', updateProgressPreview);

        // Form submission
        document.getElementById('goalForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const goalData = {
                name: formData.get('goalName'),
                description: formData.get('description'),
                targetAmount: parseFloat(formData.get('targetAmount')),
                currentAmount: parseFloat(formData.get('currentAmount')) || 0,
                targetDate: formData.get('targetDate') || null,
                priority: formData.get('priority')
            };

            // Calculate progress percentage
            goalData.progress = goalData.targetAmount > 0 ? 
                Math.min((goalData.currentAmount / goalData.targetAmount) * 100, 100) : 0;

            console.log('Goal data:', goalData);
            
            // Here you would typically send the data to your backend
            // For now, we'll just show a success message and close the modal
            alert('Goal created successfully!');
            closeModal();
        });

        function closeModal() {
            if (window.parent) {
                window.parent.postMessage('closeModal', '*');
            }
        }

        // Initialize Lucide icons
        lucide.createIcons();
    </script>
</body>
</html>
